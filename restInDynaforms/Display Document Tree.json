{"name":"Display Document Tree","description":"","items":[{"type":"form","variable":"","var_uid":"","dataType":"","id":"7138133805ae9ffdc990d96046992497","name":"Display Document Tree","description":"","mode":"edit","script":{"type":"js","code":"var host = PMDynaform.getHostName();              // get the hostname\nvar ws = PMDynaform.getWorkspaceName();           // get the current workspace\nvar token = PMDynaform.getAccessToken();          // get the access Token\nvar listTree = '';\n\nfunction getSubfolders(folderId, indent, startingFolder) {\n    if (folderId == \"root\") {\n        listTree = \"<ul><li>\\/</li>\\n\";\n        indent += '  ';\n    }\n    else if (startingFolder == true) {\n        listTree = '';\n    }\n  \n    $.ajax({\n        url: host+\"/api/1.0/\"+ws+\"/extrarest/documents/\"+folderId+\"/folders\",                \n        type: \"GET\",\n        async: false, \n        beforeSend: function(xhr){\n          xhr.setRequestHeader('Authorization', 'Bearer '+token);\n        },       \n        success: function(oFolders) {\n          console.log(oFolders);\n          listTree += \"<ul>\\n\";\n          \n          for (var idx = 0; idx < oFolders.folders.length; idx++) {\n            console.log(idx + \":\"+ oFolders.folders[idx].FOLDER_NAME);\n            \n            listTree += indent + \"<li><strong>\" + oFolders.folders[idx].FOLDER_NAME + \"</strong></li>\\n\";\n            getSubfolders(oFolders.folders[idx].FOLDER_UID, indent+\"  \", false);\n          }\n          \n          getFolderContents(folderId, indent);\n          listTree += \"</ul>\\n\";\n          \n          if (folderId == \"root\") {\n            listTree += \"</ul>\\n\";\n          }\n          \n          if (folderId == \"root\" || startingFolder == true) {\n            $(\"#docListPanel\").find(\"div.panel-body\").html(listTree);\n          }\n        },\n        contentType: \"application/json; charset=utf-8\",\n        error:function(error) {\n          alert(error);\n          console.log(error);\n        }\n    });\n}\n\nfunction getFolderContents(folderId, indent) {\n  $.ajax({\n        url: host+\"/api/1.0/\"+ws+\"/extrarest/documents/\"+folderId+\"/contents?limit=50\",                 \n        type: \"GET\",\n        async: false,\n        beforeSend: function(xhr){\n          xhr.setRequestHeader('Authorization', 'Bearer '+token);\n        },       \n        success: function(oDocList) {\n          console.log(oDocList);                        \n          for (i = 0; i < oDocList.documents.length; i++) { \n            if (oDocList.documents[i].APP_DOC_TYPE == 'OUTPUT') {  \n              listTree += indent + '<li><a href=\"' + oDocList.documents[i].DOWNLOAD_LINK +\n              \t'\">' + oDocList.documents[i].APP_DOC_FILENAME + \n                oDocList.documents[i].DOWNLOAD_LABEL + \"</a></li>\\n\";\n              \n              if (oDocList.documents[i].DOWNLOAD_LINK1 != '') {\n              \tlistTree += indent + '<li><a href=\"' + oDocList.documents[i].DOWNLOAD_LINK1 +\n              \t\t'\">' + oDocList.documents[i].APP_DOC_FILENAME + \n                \toDocList.documents[i].DOWNLOAD_LABEL1 + \"</a></li>\\n\";\n              }\n            }\n            else { // if an Input Document or attached file:\n              listTree += indent + '<li><a href=\"' + oDocList.documents[i].DOWNLOAD_LINK +\n              \t'\">' + oDocList.documents[i].APP_DOC_FILENAME + \"</a></li>\\n\";\n            }\n          }  \n        },\n        contentType: \"application/json; charset=utf-8\",\n        error:function(error) {\n          alert(error);\n          console.log(error);\n        }\n    });\n}\n\nfunction getDocList() {\n  getSubfolders(\"root\", \"\");  \n}\n\n$(\"#docListBtn\").find('button').click(getDocList);\n\n\n"},"language":"en","externalLibs":"","printable":false,"items":[[{"type":"panel","id":"docListPanel","content":"","border":"1px","colSpan":12}],[{"type":"button","id":"docListBtn","name":"docListBtn","label":"Get Document List","colSpan":12}]],"variables":[]}]}